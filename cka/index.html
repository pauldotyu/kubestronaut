
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ckad/">
      
      
        <link rel="next" href="../cks/">
      
      
      <link rel="icon" href="../assets/kubestronaut-stacked-color.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Certified Kubernetes Administrator (CKA) - So you want to be a Kubestronaut</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-8TB1PXGXJZ"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-8TB1PXGXJZ",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8TB1PXGXJZ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="So you want to be a Kubestronaut" class="md-header__button md-logo" aria-label="So you want to be a Kubestronaut" data-md-component="logo">
      
  <img src="../assets/kubestronaut-stacked-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            So you want to be a Kubestronaut
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Certified Kubernetes Administrator (CKA)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pauldotyu/kubestronaut" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="So you want to be a Kubestronaut" class="md-nav__button md-logo" aria-label="So you want to be a Kubestronaut" data-md-component="logo">
      
  <img src="../assets/kubestronaut-stacked-white.png" alt="logo">

    </a>
    So you want to be a Kubestronaut
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pauldotyu/kubestronaut" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../vmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install VMware
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Ubuntu Server
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Kubernetes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../kcna/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes and Cloud Native Associate (KCNA)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../kcsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes and Cloud Native Security Associate (KCSA)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Certified Kubernetes Application Developer (CKAD)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Certified Kubernetes Administrator (CKA)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Certified Kubernetes Administrator (CKA)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Managing core components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing core components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#managing-kube-apiserver" class="md-nav__link">
    <span class="md-ellipsis">
      Managing kube-apiserver
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing kube-apiserver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-validatingadmissionpolicy" class="md-nav__link">
    <span class="md-ellipsis">
      Enable ValidatingAdmissionPolicy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-kubelet" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting kubelet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backing-up-and-restoring-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      Backing up and restoring etcd
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backing up and restoring etcd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#take-a-snapshot-of-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      Take a snapshot of etcd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-etcd-from-a-snapshot" class="md-nav__link">
    <span class="md-ellipsis">
      Restore etcd from a snapshot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securing-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Securing a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Securing a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#granting-rbac-to-serviceaccounts" class="md-nav__link">
    <span class="md-ellipsis">
      Granting RBAC to ServiceAccounts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrading-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrading a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upgrading a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-plane" class="md-nav__link">
    <span class="md-ellipsis">
      Control plane
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Control plane">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drain-node" class="md-nav__link">
    <span class="md-ellipsis">
      Drain node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-repository-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Package repository updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeadm-upgrade" class="md-nav__link">
    <span class="md-ellipsis">
      kubeadm upgrade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubelet-and-kubectl-upgrades" class="md-nav__link">
    <span class="md-ellipsis">
      kubelet and kubectl upgrades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uncordon-node" class="md-nav__link">
    <span class="md-ellipsis">
      Uncordon node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-upgrade" class="md-nav__link">
    <span class="md-ellipsis">
      Verify upgrade
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Worker nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Worker nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drain-node_1" class="md-nav__link">
    <span class="md-ellipsis">
      Drain node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-repository-updates_1" class="md-nav__link">
    <span class="md-ellipsis">
      Package repository updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeadm-upgrade_1" class="md-nav__link">
    <span class="md-ellipsis">
      kubeadm upgrade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubelet-and-kubectl-upgrades_1" class="md-nav__link">
    <span class="md-ellipsis">
      kubelet and kubectl upgrades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-kubelet" class="md-nav__link">
    <span class="md-ellipsis">
      Restart kubelet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-upgrade_1" class="md-nav__link">
    <span class="md-ellipsis">
      Verify upgrade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uncordon-node_1" class="md-nav__link">
    <span class="md-ellipsis">
      Uncordon node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Certified Kubernetes Security Specialist (CKS)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../exam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exam tips
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../next/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What's next?
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Managing core components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing core components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#managing-kube-apiserver" class="md-nav__link">
    <span class="md-ellipsis">
      Managing kube-apiserver
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing kube-apiserver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-validatingadmissionpolicy" class="md-nav__link">
    <span class="md-ellipsis">
      Enable ValidatingAdmissionPolicy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-kubelet" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting kubelet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backing-up-and-restoring-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      Backing up and restoring etcd
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backing up and restoring etcd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#take-a-snapshot-of-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      Take a snapshot of etcd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-etcd-from-a-snapshot" class="md-nav__link">
    <span class="md-ellipsis">
      Restore etcd from a snapshot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securing-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Securing a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Securing a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#granting-rbac-to-serviceaccounts" class="md-nav__link">
    <span class="md-ellipsis">
      Granting RBAC to ServiceAccounts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrading-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrading a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upgrading a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-plane" class="md-nav__link">
    <span class="md-ellipsis">
      Control plane
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Control plane">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drain-node" class="md-nav__link">
    <span class="md-ellipsis">
      Drain node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-repository-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Package repository updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeadm-upgrade" class="md-nav__link">
    <span class="md-ellipsis">
      kubeadm upgrade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubelet-and-kubectl-upgrades" class="md-nav__link">
    <span class="md-ellipsis">
      kubelet and kubectl upgrades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uncordon-node" class="md-nav__link">
    <span class="md-ellipsis">
      Uncordon node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-upgrade" class="md-nav__link">
    <span class="md-ellipsis">
      Verify upgrade
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Worker nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Worker nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drain-node_1" class="md-nav__link">
    <span class="md-ellipsis">
      Drain node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-repository-updates_1" class="md-nav__link">
    <span class="md-ellipsis">
      Package repository updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeadm-upgrade_1" class="md-nav__link">
    <span class="md-ellipsis">
      kubeadm upgrade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubelet-and-kubectl-upgrades_1" class="md-nav__link">
    <span class="md-ellipsis">
      kubelet and kubectl upgrades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-kubelet" class="md-nav__link">
    <span class="md-ellipsis">
      Restart kubelet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-upgrade_1" class="md-nav__link">
    <span class="md-ellipsis">
      Verify upgrade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uncordon-node_1" class="md-nav__link">
    <span class="md-ellipsis">
      Uncordon node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/pauldotyu/kubestronaut/edit/main/docs/cka.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/pauldotyu/kubestronaut/raw/main/docs/cka.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


  <h1>Certified Kubernetes Administrator (CKA)</h1>

<h2 id="overview">Overview</h2>
<p>After you get past the CKAD exam, you should have a solid understanding of fundamental Kubernetes concepts and be ready to move on to the next level. This exam, is just as intense as the CKAD exam but focuses on the administrative tasks that you would need to perform as a Kubernetes administrator. This includes things like setting up and managing clusters, managing workloads, taking backups of the etcd database, performing cluster upgrades, and more.</p>
<p>Read through the <a href="https://training.linuxfoundation.org/certification/certified-kubernetes-administrator-cka/">Certified Kubernetes Administrator (CKA)</a> page for Domain and Competency details and information on how to register for the exam.</p>
<p>Some of the hands on activities that you should be comfortable with are:</p>
<ul>
<li>Upgrading a cluster</li>
<li>Managing role-based access control (RBAC)</li>
<li>Managing network policies</li>
<li>Managing storage</li>
<li>Managing cluster components</li>
<li>etcd database backup and restore</li>
<li>Configuring the kube-apiserver</li>
<li>Troubleshooting a cluster</li>
</ul>
<p>To begin, SSH into the control node and switch to the root user.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>-i
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Many CKA tasks require elevated permissions to perform certain tasks especially when working with files and directories that are owned by the root user or using the crictl CLI tool. If you need to run kubectl commands as the root user, you'll need to export the KUBECONFIG environment variable by running the following command:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</code></pre></div>
</div>
<h2 id="managing-core-components">Managing core components</h2>
<p>The core components of a Kubernetes cluster are:</p>
<ul>
<li>etcd</li>
<li>kube-apiserver</li>
<li>kube-controller-manager</li>
<li>kube-scheduler</li>
</ul>
<p>When using <a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/">kubeadm</a> to bootstrap a cluster, these components are automatically deployed as static pods. <a href="https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/">Static pods</a> are managed by the kubelet and are defined in manifest files located at <code>/etc/kubernetes/manifests</code> on the control plane node. The kubelet will automatically start and manage these pods.</p>
<p>Run the following command to view the manifest files.</p>
<div class="highlight"><pre><span></span><code>ll<span class="w"> </span>/etc/kubernetes/manifests
</code></pre></div>
<p>To make changes to any of these components, you'll need to edit the manifest file and the kubelet will automatically restart the pod with the new configuration.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When making changes to the manifest files, you should always make a backup of the original file before making any changes. This will allow you to revert back to the original configuration if something goes wrong.</p>
</div>
<p>The status of the static pods can be checked by running the following command.</p>
<div class="highlight"><pre><span></span><code>crictl<span class="w"> </span>ps
</code></pre></div>
<p>If all is well, you should see output similar to the following.</p>
<div class="highlight"><pre><span></span><code>CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD
3193217d296c0       f9818b4cd5fcb       8 hours ago         Running             frr-metrics               0                   c890c7a3a0205       metallb-speaker-v5b4s
b18b948ca4484       f9818b4cd5fcb       8 hours ago         Running             reloader                  0                   c890c7a3a0205       metallb-speaker-v5b4s
9d613f23e25d4       f9818b4cd5fcb       8 hours ago         Running             frr                       0                   c890c7a3a0205       metallb-speaker-v5b4s
5e1922db4e666       f1e519d0f31b3       8 hours ago         Running             speaker                   0                   c890c7a3a0205       metallb-speaker-v5b4s
6c3e8111d7b31       2f6c962e7b831       8 hours ago         Running             coredns                   0                   66036843831f6       coredns-7c65d6cfc9-cvjb8
62813ada99f50       2f6c962e7b831       8 hours ago         Running             coredns                   0                   c4b818a26a66a       coredns-7c65d6cfc9-vldm9
35463beb7567d       62788cf8a7b25       8 hours ago         Running             cilium-operator           0                   1b0127859d68d       cilium-operator-595959995b-qj6rh
1290ffeb922f3       00ec0a2d78b34       8 hours ago         Running             cilium-envoy              0                   5de31704930bb       cilium-envoy-f2f8h
89c01101f07bf       866c4ad7c1bbd       8 hours ago         Running             cilium-agent              0                   9d9cacb4d69ed       cilium-9fm7w
8cbedd9d34e91       dc056e81c1f77       8 hours ago         Running             kube-proxy                0                   278ea959179c6       kube-proxy-wbfgj
c8f1fa1747310       e0b799edb30ee       8 hours ago         Running             kube-scheduler            0                   caed0974f8975       kube-scheduler-control
9efee977a5534       27e3830e14027       8 hours ago         Running             etcd                      0                   c3e78bddfb219       etcd-control
e2184b59d426e       873e20495ccf3       8 hours ago         Running             kube-apiserver            0                   7ea6c543df23b       kube-apiserver-control
e1c292d2aa6be       389ff6452ae41       8 hours ago         Running             kube-controller-manager   0                   0ca20c7dfab9f       kube-controller-manager-control
</code></pre></div>
<h3 id="managing-kube-apiserver">Managing kube-apiserver</h3>
<p>The kube-apiserver is the control plane component that exposes the Kubernetes API. It is the front-end for the Kubernetes control plane. So securing the kube-apiserver is critical to the security of the entire cluster. Most of your tasks will involve making changes to the kube-apiserver configuration.</p>
<p>The kube-apiserver is configured using a manifest file located at <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code>.</p>
<p>Run the following command to view the kube-apiserver static pod manifest file.</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/etc/kubernetes/manifests/kube-apiserver.yaml
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There are a lot of flags that you can use to configure the kube-apiserver. Be sure to bookmark the <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/">kube-apiserver reference</a> for a complete list and explanation of each flag.</p>
</div>
<p>Whenever you are asked to make changes to the way the kube-apiserver is accessed or secured, this is the file you need to edit and the kubelet will automatically restart the kube-apiserver Pod with the new configuration.</p>
<h4 id="enable-validatingadmissionpolicy">Enable ValidatingAdmissionPolicy</h4>
<p>Run the following command to edit the kube-apiserver manifest to enable the <a href="https://kubernetes.io/docs/reference/access-authn-authz/validating-admission-policy/">ValidatingAdmissionPolicy</a> admission plugin. It validates requests to the Kubernetes API before they are persisted to etcd. It can be used to enforce policies like ensuring that all Pods have resource requests and limits, or that all Pods have a certain label.</p>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/kubernetes/manifests/kube-apiserver.yaml
</code></pre></div>
<p>Locate the <code>--enable-admission-plugins</code> flag, add <code>ValidatingAdmissionPolicy</code> to the list of plugins, then save and exit the file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The list of plugins is comma separated.</p>
</div>
<p>After making changes to the kube-apiserver manifest you should keep a watch on the static Pods to ensure the kube-apiserver restarts with the new configuration. It is very common to make a mistake and not realize it until you try to use kubectl and it doesn't work.</p>
<p>Run the following command to watch the static Pods and ensure they are all running.</p>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>crictl<span class="w"> </span>ps
</code></pre></div>
<p>You will see the kube-apiserver be removed from the list of running Pods and then reappear with the new configuration.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you don't see the kube-apiserver reappear, that probably means there was an error in the configuration file. So it is always a good idea to make a backup of the original file before making any changes.</p>
</div>
<h3 id="troubleshooting-kubelet">Troubleshooting kubelet</h3>
<p>The kubelet runs as a process on each node in the cluster and is responsible for managing the Pods and containers. </p>
<p>You might encounter a situation where the components aren't running. In this case, you should check the status of the kubelet process by running the following command.</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>kubelet
</code></pre></div>
<p>If you see <code>active (running)</code> highlighted in green, then the kubelet is running. If not, you'll need to start the kubelet by running the following command.</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>kubelet
</code></pre></div>
<p>If the kubelet is running but you suspect some components aren't running. You can check the status of the components by running the following command.</p>
<div class="highlight"><pre><span></span><code>crictl<span class="w"> </span>ps
</code></pre></div>
<p>You can see in the output that a few components aren't running, like the kube-apiserver and kube-controller-manager. This should lead you to check the manifests for these components to see what is going on or check the logs of the kubelet to see if there are any errors.</p>
<div class="highlight"><pre><span></span><code>CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD
88639aaca1dd1       d48f992a22722       2 days ago          Running             kube-scheduler            18                  ec844d5e5a039       kube-scheduler-control
2c7467d60a7a6       014faa467e297       3 days ago          Running             etcd                      7                   f5c73fde48d08       etcd-control
cdfa1217a1a25       8e97cdb19e7cc       3 days ago          Running             kube-controller-manager   17                  f78f21be20d53       kube-controller-manager-control
0930536d04d9a       528878d09e0ce       4 weeks ago         Running             cilium-envoy              6                   077c262fdc09c       cilium-envoy-9r7dk
c6dcda213517c       2351f570ed0ea       4 weeks ago         Running             kube-proxy                6                   b4fbd18b3b311       kube-proxy-ffd5z
</code></pre></div>
<p>To help troubleshoot the kubelet, you can check the logs by running the following command.</p>
<div class="highlight"><pre><span></span><code>journalctl<span class="w"> </span>-u<span class="w"> </span>kubelet
</code></pre></div>
<p>If you need to check to see how the kubelet is configured, you can run the following command.</p>
<div class="highlight"><pre><span></span><code>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>kubelet
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This assumes the kubelet is running as a process on the node.</p>
</div>
<p>The text will be a bit jumbled, but you should be able to see the flags that are being passed to the kubelet process.</p>
<p>For example, you might see something like this.</p>
<div class="highlight"><pre><span></span><code>root        9848  1.0  2.5 2044616 100760 ?      Ssl  13:37   0:37 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.10
</code></pre></div>
<p>This shows that the kubelet is using a configuration files located at <code>/etc/kubernetes/kubelet.conf</code> and <code>/var/lib/kubelet/config.yaml</code> which can also be helpful when troubleshooting.</p>
<h3 id="backing-up-and-restoring-etcd">Backing up and restoring etcd</h3>
<p>The etcd database is a key component of a Kubernetes cluster. It stores the state of the cluster and is used by the control plane components to coordinate and manage the cluster. Backing up the etcd database is critical to ensure that you can recover from any data loss or corruption.</p>
<h4 id="take-a-snapshot-of-etcd">Take a snapshot of etcd</h4>
<p>The etcdctl is the tool you'll use to manage the etcd database. It is installed on the control plane node but needs sudo access to run.</p>
<p>Now run the following command to see the available commands.</p>
<div class="highlight"><pre><span></span><code>etcdctl<span class="w"> </span>--help<span class="w"> </span><span class="c1"># or -h</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure you've switched to the root user with <code>sudo -i</code> before running the above command.</p>
</div>
<p>You will see there is a command to take a snapshot of the etcd database. Let's see what the command needs.</p>
<div class="highlight"><pre><span></span><code>etcdctl<span class="w"> </span>snapshot<span class="w"> </span>save<span class="w"> </span>-h
</code></pre></div>
<p>The command needs a path to save the snapshot to and accepts a few flags to configure how the client connects to the etcd server.</p>
<p>With kubeadm, etcd is run as a static pod on the control plane node and defined in a manifest file located at <code>/etc/kubernetes/manifests/etcd.yaml</code>. This file will give you everything you need to connect to the etcd server.</p>
<p>You can view the manifest file by running the following command.</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/etc/kubernetes/manifests/etcd.yaml
</code></pre></div>
<p>It's a fairly long file, but locate the <code>- command</code> section and you'll see the following:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etcd</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--advertise-client-urls=https://172.16.25.132:2379</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--cert-file=/etc/kubernetes/pki/etcd/server.crt</span><span class="w">           </span><span class="c1"># need this</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--client-cert-auth=true</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--data-dir=/var/lib/etcd</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--experimental-initial-corrupt-check=true</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--experimental-watch-progress-notify-interval=5s</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--initial-advertise-peer-urls=https://172.16.25.132:2380</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--initial-cluster=control=https://172.16.25.132:2380</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--key-file=/etc/kubernetes/pki/etcd/server.key</span><span class="w">            </span><span class="c1"># need this</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--listen-client-urls=https://127.0.0.1:2379,https://172.16.25.132:2379</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--listen-metrics-urls=http://127.0.0.1:2381</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--listen-peer-urls=https://172.16.25.132:2380</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--name=control</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--peer-client-cert-auth=true</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--peer-key-file=/etc/kubernetes/pki/etcd/peer.key</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--snapshot-count=10000</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span><span class="w">         </span><span class="c1"># need this</span>
</code></pre></div>
<p>Based on what we see here, it looks like we can connect to the etcd server using the same certificates that are used by the Pod. The <code>--cert-file</code> and <code>--key-file</code> flags specify the client certificate and key to use for authentication. The <code>--trusted-ca-file</code> flag specifies the CA certificate to use for verifying the server's certificate.</p>
<p>Using the certificates that the etcd pod uses, run the following command to take a snapshot of the etcd database and save it to <code>/tmp/etcd-backup.db</code>.</p>
<div class="highlight"><pre><span></span><code>etcdctl<span class="w"> </span>snapshot<span class="w"> </span>save<span class="w"> </span>/tmp/etcd-backup.db<span class="w"> </span><span class="se">\</span>
--cacert<span class="o">=</span>/etc/kubernetes/pki/etcd/ca.crt<span class="w"> </span><span class="se">\</span>
--cert<span class="o">=</span>/etc/kubernetes/pki/etcd/server.crt<span class="w"> </span><span class="se">\</span>
--key<span class="o">=</span>/etc/kubernetes/pki/etcd/server.key
</code></pre></div>
<h4 id="restore-etcd-from-a-snapshot">Restore etcd from a snapshot</h4>
<p>With the snapshot saved, let's see how to restore the etcd database from a snapshot.</p>
<p>First thing you need to do is stop the etcd Pod. You can do this by simply moving the etcd manifest file to a different location. The kubelet will see that the manifest file is no longer there and stop the Pod.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/etc/kubernetes/manifests

<span class="c1"># move all manifest files to parent directory</span>
mv<span class="w"> </span>*<span class="w"> </span>..<span class="w"> </span>
</code></pre></div>
<p>Make sure the control plane components aren't running.</p>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>crictl<span class="w"> </span>ps
</code></pre></div>
<p>Once you see that the etcd Pod isn't running, press <code>Ctrl+C</code> to exit the watch command and proceed to restore the etcd database from the snapshot. </p>
<p>Let's run help on the <code>etcdctl snapshot restore</code> command to see what it needs.</p>
<div class="highlight"><pre><span></span><code>etcdctl<span class="w"> </span>snapshot<span class="w"> </span>restore<span class="w"> </span>-h
</code></pre></div>
<p>You will see that the command needs a path to the snapshot file, a path to the data directory which is where the etcd database is stored, and a few flags to configure how the client connects to the etcd server, like the <code>etcdctl snapshot save</code> command.</p>
<p>The <code>--data-dir</code> flag is the path to the data directory where the etcd database is stored. This is usually <code>/var/lib/etcd</code> but you can confirm this by looking at the <code>- command</code> section of the etcd static pod manifest file.</p>
<p>When you perform a restore, you can specify a different data directory to restore to. This is useful if you want to keep the original data directory intact.</p>
<p>Run the following command to restore the etcd database from the snapshot.</p>
<div class="highlight"><pre><span></span><code>etcdctl<span class="w"> </span>snapshot<span class="w"> </span>restore<span class="w"> </span>/tmp/etcd-backup.db<span class="w"> </span><span class="se">\</span>
--data-dir<span class="o">=</span>/var/lib/etcd-from-backup<span class="w"> </span><span class="se">\</span>
--cacert<span class="o">=</span>/etc/kubernetes/pki/etcd/ca.crt<span class="w"> </span><span class="se">\</span>
--cert<span class="o">=</span>/etc/kubernetes/pki/etcd/server.crt<span class="w"> </span><span class="se">\</span>
--key<span class="o">=</span>/etc/kubernetes/pki/etcd/server.key
</code></pre></div>
<p>Now that you've restored the etcd database to a different directory, you'll need to update the etcd static pod manifest file to point to the new data directory.</p>
<p>Make a backup of the original etcd static pod manifest file.</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>../etcd.yaml<span class="w"> </span>etcd.yaml.bak
</code></pre></div>
<p>Use Vim to edit the etcd static pod manifest file.</p>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>../etcd.yaml
</code></pre></div>
<p>Locate the <code>- hostPath</code> spec under <code>volumes</code> for <code>etcd-data</code> and update the path to the new data directory.</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/etcd-from-backup</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DirectoryOrCreate</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">etcd-data</span>
</code></pre></div>
<p>Save and exit the file.</p>
<p>Move the static pod manifest files back to the <code>/etc/kubernetes/manifests</code> directory.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># move all yaml files back</span>
mv<span class="w"> </span>../*.yaml<span class="w"> </span>.
</code></pre></div>
<p>Run the following command and wait for the etcd Pod to start.</p>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>crictl<span class="w"> </span>ps
</code></pre></div>
<p><strong>Reference:</strong> <a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster">https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster</a></p>
<h2 id="securing-a-cluster">Securing a cluster</h2>
<p>We'll get to security a bit more in the next section but one component of cluster security is RBAC and ServiceAccounts. In Kubernetes, users aren't stored as API objects but are authenticated through various mechanisms (certificates, tokens, OIDC, etc.). Inside the cluster, workloads use <a href="https://kubernetes.io/docs/concepts/security/service-accounts/">Service Accounts</a> for identity, which are Kubernetes API objects that can be bound to roles which define what actions can be performed on resources.</p>
<p>When you manage RBAC in Kubernetes, you define a <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole">Role or ClusterRole</a> which is a set of permissions. You then create a <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#rolebinding-and-clusterrolebinding">RoleBinding or ClusterRoleBinding</a> which binds the Role or ClusterRole to a Service Account, user, or group. The difference between a Role and a ClusterRole is that a Role is namespaced and a ClusterRole isn't. Likewise a RoleBinding is namespaced and a ClusterRoleBinding isn't.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Roles can only be combined with RoleBindings but a ClusterRole can be used with both RoleBindings and ClusterRoleBindings making it more flexible across namespaces.</p>
</div>
<h3 id="granting-rbac-to-serviceaccounts">Granting RBAC to ServiceAccounts</h3>
<p>Run the following command to create a new Service Account.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>serviceaccount<span class="w"> </span>my-service-account
</code></pre></div>
<p>Run the following command to create a new Role.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>role<span class="w"> </span>my-role<span class="w"> </span>--verb<span class="o">=</span>get<span class="w"> </span>--verb<span class="o">=</span>list<span class="w"> </span>--resource<span class="o">=</span>pods
</code></pre></div>
<p>Run the following command to bind the Role to the Service Account.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>rolebinding<span class="w"> </span>my-role-binding<span class="w"> </span>--role<span class="o">=</span>my-role<span class="w"> </span>--serviceaccount<span class="o">=</span>default:my-service-account
</code></pre></div>
<p>Run the following command to verify the service account can only list pods.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>list<span class="w"> </span>pods<span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:default:my-service-account
</code></pre></div>
<p>You should see <code>yes</code> as the output.</p>
<p>Run the following command to verify the service account cannot create pods.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>create<span class="w"> </span>pods<span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:default:my-service-account
</code></pre></div>
<p>You should see <code>no</code> as the output.</p>
<p><strong>Reference:</strong> <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">https://kubernetes.io/docs/reference/access-authn-authz/rbac/</a></p>
<h2 id="upgrading-a-cluster">Upgrading a cluster</h2>
<p>Upgrading a cluster is a critical task that needs to be done carefully to avoid any downtime. The upgrade process involves upgrading the control plane components and then upgrading the worker nodes. It's a tedious and time consuming task on the exam, but worth a lot of points and can be done quickly with practice.</p>
<h3 id="control-plane">Control plane</h3>
<p>Run the command to get the list of nodes and the Kubernetes version they are running.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When running as the root user, you'll need to run the following command to export the KUBECONFIG environment variable to run kubectl commands.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</code></pre></div>
</div>
<h4 id="drain-node">Drain node</h4>
<p>Before upgrading the control plane, you should drain the control node to prevent any new Pods from being scheduled on it.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>drain<span class="w"> </span>control<span class="w"> </span>--ignore-daemonsets
</code></pre></div>
<h4 id="package-repository-updates">Package repository updates</h4>
<p>Check to see what version of kubeadm and kubelet you are running.</p>
<div class="highlight"><pre><span></span><code>kubeadm<span class="w"> </span>version
kubelet<span class="w"> </span>--version
</code></pre></div>
<p>Both kubeadm and kubelet should be running v1.31.6. Change the package repository to point to the v1.32.x packages.</p>
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/v1.31/v1.32/g&#39;</span><span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list
</code></pre></div>
<p>Update the package list.</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>update
</code></pre></div>
<p><strong>Reference:</strong> <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/change-package-repository/#verifying-if-the-kubernetes-package-repositories-are-used">https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/change-package-repository/#verifying-if-the-kubernetes-package-repositories-are-used</a></p>
<p>Check to see what versions of the Kubernetes packages you can upgrade to.</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>list<span class="w"> </span>--upgradable<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>kube
</code></pre></div>
<p>The packages were held back when you installed them to prevent automatic upgrades. Unhold the packages by running the following command.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>unhold<span class="w"> </span>kubeadm
</code></pre></div>
<p>Upgrade the kubeadm package to v1.32.2.</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">kubeadm</span><span class="o">=</span><span class="m">1</span>.32.2-1.1
</code></pre></div>
<p>Hold the kubeadm package again to prevent inadvertent upgrades.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubeadm
</code></pre></div>
<h4 id="kubeadm-upgrade">kubeadm upgrade</h4>
<p>Run the following command to check if the upgrade is possible.</p>
<div class="highlight"><pre><span></span><code>kubeadm<span class="w"> </span>upgrade<span class="w"> </span>plan
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you see any preflight errors, you may be able to simply re-run the command as they are often transient and resolve themselves.</p>
</div>
<p>If the upgrade check went well, you'll see the following output.</p>
<div class="highlight"><pre><span></span><code>[preflight] Running pre-flight checks.
[upgrade/config] Reading configuration from the &quot;kubeadm-config&quot; ConfigMap in namespace &quot;kube-system&quot;...
[upgrade/config] Use &#39;kubeadm init phase upload-config --config your-config.yaml&#39; to re-upload it.
[upgrade] Running cluster health checks
[upgrade] Fetching available versions to upgrade to
[upgrade/versions] Cluster version: 1.31.6
[upgrade/versions] kubeadm version: v1.32.2
[upgrade/versions] Target version: v1.32.2
[upgrade/versions] Latest version in the v1.31 series: v1.31.6

Components that must be upgraded manually after you&#39;ve upgraded the control plane with &#39;kubeadm upgrade apply&#39;:
COMPONENT   NODE       CURRENT   TARGET
kubelet     worker-1   v1.31.6   v1.32.2
kubelet     worker-2   v1.31.6   v1.32.2
kubelet     control    v1.32.2   v1.32.2

Upgrade to the latest stable version:

COMPONENT                 NODE      CURRENT    TARGET
kube-apiserver            control   v1.31.6    v1.32.2
kube-controller-manager   control   v1.31.6    v1.32.2
kube-scheduler            control   v1.31.6    v1.32.2
kube-proxy                          1.31.6     v1.32.2
CoreDNS                             v1.11.3    v1.11.3
etcd                      control   3.5.15-0   3.5.16-0

You can now apply the upgrade by executing the following command:

    kubeadm upgrade apply v1.32.2

_____________________________________________________________________


The table below shows the current state of component configs as understood by this version of kubeadm.
Configs that have a &quot;yes&quot; mark in the &quot;MANUAL UPGRADE REQUIRED&quot; column require manual config upgrade or
resetting to kubeadm defaults before a successful upgrade can be performed. The version to manually
upgrade to is denoted in the &quot;PREFERRED VERSION&quot; column.

API GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED
kubeproxy.config.k8s.io   v1alpha1          v1alpha1            no
kubelet.config.k8s.io     v1beta1           v1beta1             no
_____________________________________________________________________
</code></pre></div>
<p>Upgrade the control plane components by running the following command.</p>
<div class="highlight"><pre><span></span><code>kubeadm<span class="w"> </span>upgrade<span class="w"> </span>apply<span class="w"> </span>v1.32.2<span class="w"> </span>--v<span class="o">=</span><span class="m">5</span>
</code></pre></div>
<p>When asked if you are sure you want to proceed, type <code>y</code> and press <code>Enter</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The upgrade process can take several minutes to complete.</p>
</div>
<h4 id="kubelet-and-kubectl-upgrades">kubelet and kubectl upgrades</h4>
<p>When the control plane upgrade is complete, you can move on to upgrading the kubelet and kubectl. Unhold the kubelet and kubectl packages so they can be upgraded.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>unhold<span class="w"> </span>kubelet<span class="w"> </span>kubectl
</code></pre></div>
<p>Upgrade the kubelet and kubectl packages to v1.32.2.</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>install<span class="w"> </span><span class="nv">kubelet</span><span class="o">=</span><span class="m">1</span>.32.2-1.1<span class="w"> </span><span class="nv">kubectl</span><span class="o">=</span><span class="m">1</span>.32.2-1.1
</code></pre></div>
<p>Hold the kubelet and kubectl packages again to prevent inadvertent upgrades.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubelet<span class="w"> </span>kubectl
</code></pre></div>
<h4 id="uncordon-node">Uncordon node</h4>
<p>With the control plane upgraded, you can uncordon the control node to allow new Pods to be scheduled on it again.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>uncordon<span class="w"> </span>control
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You might need to wait a minute or two for the control plane components to come back up since the kubelet will need to restart and eventually restart the static pods.</p>
</div>
<h4 id="verify-upgrade">Verify upgrade</h4>
<p>Run the following command to verify the control node is upgraded to v1.32.2.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
<p>Your output should look like this.</p>
<div class="highlight"><pre><span></span><code>NAME       STATUS   ROLES           AGE   VERSION
control    Ready    control-plane   15h   v1.32.2  # upgraded
worker-1   Ready    &lt;none&gt;          15h   v1.31.6
worker-2   Ready    &lt;none&gt;          15h   v1.31.6
</code></pre></div>
<p>You can see the control node is now running v1.32.2 and the worker nodes are still running v1.31.6. You need to upgrade the worker nodes next.</p>
<h3 id="worker-nodes">Worker nodes</h3>
<h4 id="drain-node_1">Drain node</h4>
<p>Before upgrading the worker nodes, you should drain the worker nodes to prevent any new Pods from being scheduled on them.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>drain<span class="w"> </span>worker-1<span class="w"> </span>--ignore-daemonsets
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure you are back on the control node before running the above command.</p>
</div>
<h4 id="package-repository-updates_1">Package repository updates</h4>
<p>SSH into the worker node and switch to the root user.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>-i
</code></pre></div>
<p>Update the package repository to point to the v1.32.x packages.</p>
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/v1.31/v1.32/g&#39;</span><span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list
</code></pre></div>
<p>Update the package list.</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>update
</code></pre></div>
<p>Unhold the kubeadm package so it can be upgraded.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>unhold<span class="w"> </span>kubeadm
</code></pre></div>
<p>Upgrade the kubeadm package to v1.32.2.</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>install<span class="w"> </span><span class="nv">kubeadm</span><span class="o">=</span><span class="m">1</span>.32.2-1.1
</code></pre></div>
<p>Hold the kubeadm package to prevent automatic upgrades again.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubeadm
</code></pre></div>
<h4 id="kubeadm-upgrade_1">kubeadm upgrade</h4>
<p>Upgrade the worker node by running the following command.</p>
<div class="highlight"><pre><span></span><code>kubeadm<span class="w"> </span>upgrade<span class="w"> </span>node<span class="w"> </span>--v<span class="o">=</span><span class="m">5</span>
</code></pre></div>
<h4 id="kubelet-and-kubectl-upgrades_1">kubelet and kubectl upgrades</h4>
<p>Unhold the kubelet and kubectl packages so they can be upgraded.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>unhold<span class="w"> </span>kubectl<span class="w"> </span>kubelet
</code></pre></div>
<p>Upgrade the kubelet and kubectl packages to v1.32.2.</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>install<span class="w"> </span><span class="nv">kubelet</span><span class="o">=</span><span class="m">1</span>.32.2-1.1<span class="w"> </span><span class="nv">kubectl</span><span class="o">=</span><span class="m">1</span>.32.2-1.1
</code></pre></div>
<p>Hold the kubelet and kubectl packages to prevent automatic upgrades again.</p>
<div class="highlight"><pre><span></span><code>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubectl<span class="w"> </span>kubelet
</code></pre></div>
<h4 id="restart-kubelet">Restart kubelet</h4>
<p>Restart the kubelet service.</p>
<div class="highlight"><pre><span></span><code>service<span class="w"> </span>kubelet<span class="w"> </span>restart
</code></pre></div>
<p>Wait a minute or two and check to make sure the kubelet service is running.</p>
<div class="highlight"><pre><span></span><code>service<span class="w"> </span>kubelet<span class="w"> </span>status
</code></pre></div>
<h4 id="verify-upgrade_1">Verify upgrade</h4>
<p>Back in the control node, run the following command to see if the worker node is ready.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure you are back on the control node before running the above command.</p>
</div>
<p>Now you should see a worker node running v1.32.2.</p>
<div class="highlight"><pre><span></span><code>NAME       STATUS                     ROLES           AGE   VERSION
control    Ready                      control-plane   15h   v1.32.2 # upgraded
worker-1   Ready,SchedulingDisabled   &lt;none&gt;          15h   v1.32.2 # upgraded
worker-2   Ready                      &lt;none&gt;          15h   v1.31.6
</code></pre></div>
<h4 id="uncordon-node_1">Uncordon node</h4>
<p>Uncordon the worker node to allow new Pods to be scheduled on it.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>uncordon<span class="w"> </span>worker-1
</code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Drain the next worker node and repeat the above steps for the remaining worker nodes.</p>
</div>
<p><strong>Reference:</strong> <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/</a></p>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://github.com/cncf/curriculum/blob/master/CKA_Curriculum_v1.32.pdf">CKA Exam Curriculum</a></li>
<li><a href="https://kodekloud.com/learning-path/cka">CKA Certification Learning Path</a></li>
</ul>









  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="..." target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ckad/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Certified Kubernetes Application Developer (CKAD)">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Certified Kubernetes Application Developer (CKAD)
              </div>
            </div>
          </a>
        
        
          
          <a href="../cks/" class="md-footer__link md-footer__link--next" aria-label="Next: Certified Kubernetes Security Specialist (CKS)">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Certified Kubernetes Security Specialist (CKS)
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  




<h4>Cookie consent</h4>
<p>I use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of the documentation and whether you can find what you're searching for. With your consent, you're helping me to make this site better. Thank you!</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "content.code.copy", "content.action.edit", "content.action.view"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>